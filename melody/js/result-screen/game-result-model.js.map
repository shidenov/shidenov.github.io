{"version":3,"file":"game-result-model.js","sources":["../data/game-data.js","game-result-model.js"],"sourcesContent":["export const TIMER = 300; // 5 min\n\nexport const GAME = Object.freeze({\n  lives: 2,\n  currentTimer: TIMER,\n  score: 0,\n  currentLevel: 0,\n  nextLevel: 1\n});\n\nexport const QuestionType = {\n  GENRE: `genre`,\n  ARTIST: `artist`\n};\n\nexport const ResultGame = {\n  WIN: `win`,\n  NOLIVES: `noLives`,\n  TIMEOUT: `timeout`\n};\n\nconst Point = {\n  CORRECT_ANSWER: 1,\n  CORRECT_FAST_ANSWER: 2,\n  LIVE: 2\n};\n\nexport const calculateScore = (answers, lives) => {\n  const trueAnswers = answers.filter((item) => item.result !== false);\n  if (answers.length !== 10 || trueAnswers.length < 8) {\n    return -1;\n  }\n\n  const fastAnswers = trueAnswers.filter((item) => item.timer <= 30);\n  const pointAnswers = ((trueAnswers.length - fastAnswers.length) * Point.CORRECT_ANSWER) + (fastAnswers.length * Point.CORRECT_FAST_ANSWER);\n  const pointLives = (GAME.lives > lives) ? (GAME.lives - lives) * Point.LIVE : 0;\n\n  return pointAnswers - pointLives;\n};\n\nexport const calculateResult = (results, currentGame) => {\n  if (currentGame.timer.time <= 0) {\n    return `Время вышло! Вы не успели отгадать все мелодии`;\n  }\n\n  if (currentGame.lives < 0) {\n    return `У вас закончились все попытки. Ничего, повезёт в следующий раз!`;\n  }\n\n  // добавим результат игры в массив\n  results.push(currentGame.score);\n  const sortResults = results.sort((a, b) => b - a);\n  const place = sortResults.indexOf(currentGame.score) + 1; // место которое занял игрок\n  const totalGamers = sortResults.length;\n  const winPercent = ((totalGamers - place) / totalGamers * 100).toFixed(0);\n\n  return `Вы заняли ${place} место из ${sortResults.length}. Это лучше чем у ${winPercent}% игроков`;\n};\n\nexport const createTimer = (time) => {\n  if (typeof time === `undefined`) {\n    throw new Error(`Не указан аргумент`);\n  }\n\n  if (typeof time !== `number`) {\n    throw new Error(`Не верный тип данных, аргументом функции может быть только число`);\n  }\n\n  return {\n    time,\n    tick() {\n      if (this.time !== 0) {\n        this.time = this.time - 1;\n      }\n      this._timeout(this.time);\n    },\n\n    _timeout(currentTime) {\n      if (currentTime === 0) {\n        this.state = `timeout`;\n      }\n    }\n  };\n};\n\nexport const convertText = (number, word, one, many, multi) => {\n  const checkNumber = (num) => {\n    return (num > 21) ? +(num.toString()[1]) : num;\n  };\n\n  number = checkNumber(number);\n  if (number === 1) {\n    return word + one;\n  }\n\n  if (number > 1 && number < 5) {\n    return word + many;\n  }\n  return (number > 1 && number < 5) ? word + many : word + multi;\n};\n\nexport const showTimeResult = (time) => {\n  const {min, sec} = time;\n\n  const minutesText = convertText(+min, `минут`, `у`, `ы`, ``);\n  const secondsText = convertText(+sec, `секунд`, `у`, `ы`, ``);\n  const seconds = (sec[0] === `0`) ? sec[1] : sec;\n  return `${min} ${minutesText} и ${seconds} ${secondsText}`;\n};\n\nexport const timerConverToMinAndSec = (timer) => {\n  const minutes = Math.floor(timer / 60);\n  const seconds = ((timer % 60) / 1).toFixed(0);\n  const convertSeconds = (seconds < 10) ? `0${seconds}` : seconds;\n\n  return {\n    min: minutes.toString(),\n    sec: convertSeconds\n  };\n};\n\nexport const getRadius = (relation, radius) => {\n  const stroke = +(2 * Math.PI * radius).toFixed();\n  const offset = +((1 - relation) * stroke).toFixed();\n  return {stroke, offset};\n};\n","import {\n  ResultGame,\n  calculateResult,\n  calculateScore,\n  timerConverToMinAndSec,\n  showTimeResult,\n  convertText,\n  TIMER\n} from '../data/game-data';\n\nexport default class ResultModel {\n  constructor(gameState) {\n    this._gameState = Object.assign({}, gameState);\n    this._calculateResult();\n  }\n\n  get resultState() {\n    if (this._gameState.resultGame === ResultGame.WIN) {\n      const timer = timerConverToMinAndSec(TIMER - this._gameState.timer.time);\n      const timeText = showTimeResult(timer);\n\n      const lives = (this._gameState.lives - 2) * -1;\n      const livesDeclination = convertText(lives, `ошиб`, `ку`, `ки`, `ок`);\n      const livesText = `${lives} ${livesDeclination}`;\n\n      // вернем данные для view\n      return {\n        lives: livesText,\n        time: timeText,\n        score: this._gameState.score,\n        totalFast: this._gameState.fastAnswers,\n        status: this._gameState.resultGame\n      };\n    }\n    return {\n      status: this._gameState.resultGame\n    };\n  }\n\n  getPlayerResult() {\n    if (this._gameState.resultGame === ResultGame.WIN) {\n      return {\n        date: new Date(),\n        lives: this._gameState.lives,\n        time: this._gameState.currentTimer,\n        score: this._gameState.score,\n        totalfastAnswers: this._gameState.fastAnswers\n      };\n    }\n    return false;\n  }\n\n  getScores(data) {\n    const scores = [];\n    data.forEach((result) => scores.push(result.score));\n    return calculateResult(scores, this._gameState);\n  }\n\n  _calculateResult() {\n    if (this._gameState.resultGame === ResultGame.WIN) {\n      this._gameState.score = calculateScore(this._gameState.answers, this._gameState.lives);\n      this._gameState.fastAnswers = (this._gameState.answers.filter((item) => item.timer <= 30)).length;\n    }\n  }\n}\n"],"names":[],"mappings":"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"}