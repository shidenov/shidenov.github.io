{"version":3,"file":"game-header-view.js","sources":["../abstract-view.js","../data/game-data.js","game-header-view.js"],"sourcesContent":["const render = (html) => {\n  const template = document.createElement(`template`);\n  template.innerHTML = html;\n  if (template.content.children.length > 1) {\n    return template.content;\n  }\n  return template.content.firstElementChild;\n};\n\nexport default class AbstractView {\n  constructor() {\n    if (new.target === AbstractView) {\n      throw new Error(`Нельзя просто так взять и cоздать экземпляр класса :)`);\n    }\n  }\n\n  get template() {\n    throw new Error(`Переопредели геттер template!`);\n  }\n\n  get element() {\n    if (this._element) {\n      return this._element;\n    }\n\n    this._element = this.render();\n    this.bind(this._element);\n    return this._element;\n  }\n\n  render() {\n    return render(this.template);\n  }\n\n  bind() {\n    // nothing to do\n  }\n}\n\n","export const TIMER = 300; // 5 min\n\nexport const GAME = Object.freeze({\n  lives: 2,\n  currentTimer: TIMER,\n  score: 0,\n  currentLevel: 0,\n  nextLevel: 1\n});\n\nexport const QuestionType = {\n  GENRE: `genre`,\n  ARTIST: `artist`\n};\n\nexport const ResultGame = {\n  WIN: `win`,\n  NOLIVES: `noLives`,\n  TIMEOUT: `timeout`\n};\n\nconst Point = {\n  CORRECT_ANSWER: 1,\n  CORRECT_FAST_ANSWER: 2,\n  LIVE: 2\n};\n\nexport const calculateScore = (answers, lives) => {\n  const trueAnswers = answers.filter((item) => item.result !== false);\n  if (answers.length !== 10 || trueAnswers.length < 8) {\n    return -1;\n  }\n\n  const fastAnswers = trueAnswers.filter((item) => item.timer <= 30);\n  const pointAnswers = ((trueAnswers.length - fastAnswers.length) * Point.CORRECT_ANSWER) + (fastAnswers.length * Point.CORRECT_FAST_ANSWER);\n  const pointLives = (GAME.lives > lives) ? (GAME.lives - lives) * Point.LIVE : 0;\n\n  return pointAnswers - pointLives;\n};\n\nexport const calculateResult = (results, currentGame) => {\n  if (currentGame.timer.time <= 0) {\n    return `Время вышло! Вы не успели отгадать все мелодии`;\n  }\n\n  if (currentGame.lives < 0) {\n    return `У вас закончились все попытки. Ничего, повезёт в следующий раз!`;\n  }\n\n  // добавим результат игры в массив\n  results.push(currentGame.score);\n  const sortResults = results.sort((a, b) => b - a);\n  const place = sortResults.indexOf(currentGame.score) + 1; // место которое занял игрок\n  const totalGamers = sortResults.length;\n  const winPercent = ((totalGamers - place) / totalGamers * 100).toFixed(0);\n\n  return `Вы заняли ${place} место из ${sortResults.length}. Это лучше чем у ${winPercent}% игроков`;\n};\n\nexport const createTimer = (time) => {\n  if (typeof time === `undefined`) {\n    throw new Error(`Не указан аргумент`);\n  }\n\n  if (typeof time !== `number`) {\n    throw new Error(`Не верный тип данных, аргументом функции может быть только число`);\n  }\n\n  return {\n    time,\n    tick() {\n      if (this.time !== 0) {\n        this.time = this.time - 1;\n      }\n      this._timeout(this.time);\n    },\n\n    _timeout(currentTime) {\n      if (currentTime === 0) {\n        this.state = `timeout`;\n      }\n    }\n  };\n};\n\nexport const convertText = (number, word, one, many, multi) => {\n  const checkNumber = (num) => {\n    return (num > 21) ? +(num.toString()[1]) : num;\n  };\n\n  number = checkNumber(number);\n  if (number === 1) {\n    return word + one;\n  }\n\n  if (number > 1 && number < 5) {\n    return word + many;\n  }\n  return (number > 1 && number < 5) ? word + many : word + multi;\n};\n\nexport const showTimeResult = (time) => {\n  const {min, sec} = time;\n\n  const minutesText = convertText(+min, `минут`, `у`, `ы`, ``);\n  const secondsText = convertText(+sec, `секунд`, `у`, `ы`, ``);\n  const seconds = (sec[0] === `0`) ? sec[1] : sec;\n  return `${min} ${minutesText} и ${seconds} ${secondsText}`;\n};\n\nexport const timerConverToMinAndSec = (timer) => {\n  const minutes = Math.floor(timer / 60);\n  const seconds = ((timer % 60) / 1).toFixed(0);\n  const convertSeconds = (seconds < 10) ? `0${seconds}` : seconds;\n\n  return {\n    min: minutes.toString(),\n    sec: convertSeconds\n  };\n};\n\nexport const getRadius = (relation, radius) => {\n  const stroke = +(2 * Math.PI * radius).toFixed();\n  const offset = +((1 - relation) * stroke).toFixed();\n  return {stroke, offset};\n};\n","import AbstractView from '../abstract-view';\nimport {getRadius, timerConverToMinAndSec, TIMER} from '../data/game-data';\n\n/* header template */\nexport default class HeaderView extends AbstractView {\n  constructor(state) {\n    super();\n    this.state = state;\n  }\n\n  get template() {\n    const svg = this.getSvgAttrOptions();\n    const timer = this.convertTime();\n\n    return `\n      <a class=\"play-again play-again__wrap\" href=\"#\">\n          <img class=\"play-again__img\" src=\"/img/melody-logo-ginger.png\" alt=\"logo\" width=\"177\" height=\"76\">\n      </a>\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"timer\" viewBox=\"0 0 780 780\">\n        <circle cx=\"390\" cy=\"390\" r=\"370\" class=\"timer-line\" stroke-dasharray=\"${svg.stroke}\" stroke-dashoffset=\"${svg.offset}\" style=\"filter: url(.#blur); transform: rotate(-90deg) scaleY(-1); transform-origin: center\"></circle>\n        <div class=\"timer-value\" xmlns=\"http://www.w3.org/1999/xhtml\">\n          <span class=\"timer-value-mins\">${timer.min}</span><!--\n        --><span class=\"timer-value-dots\">:</span><!--\n        --><span class=\"timer-value-secs\">${timer.sec}</span>\n        </div>\n      </svg>\n      <div class=\"main-mistakes\">\n        ${new Array((this.state.lives - 2) * -1).fill(`<img class=\"main-mistake\" src=\"img/wrong-answer.png\" width=\"35\" height=\"49\">`).join(``)}\n      </div>\n    `;\n  }\n\n  onClick() { }\n\n  bind() {\n    this.minElement = this.element.querySelector(`.timer-value-mins`);\n    this.secElement = this.element.querySelector(`.timer-value-secs`);\n    this.circleElement = this.element.querySelector(`circle`);\n    this.timerElement = this.element.querySelector(`.timer-value`);\n    const playAgainButton = this.element.querySelector(`.play-again`);\n    playAgainButton.addEventListener(`click`, this.onClick);\n  }\n\n  // публичный метод, используется в game-screen\n  convertTime() {\n    return timerConverToMinAndSec(this.state.timer.time);\n  }\n\n  // публичный метод, используется в game-screen\n  getSvgAttrOptions() {\n    const timerRelation = this.state.timer.time / TIMER;\n    return getRadius(timerRelation, 370);\n  }\n}\n"],"names":[],"mappings":"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"}